package com.ote.test.model;

import org.hibernate.HibernateException;
import org.hibernate.engine.spi.SessionImplementor;

import java.io.Serializable;

public abstract class IdentifierGenerator<TE extends IEntity<TK>, TK extends IEntity.Key> implements org.hibernate.id.IdentifierGenerator {

    @Override
    public Serializable generate(SessionImplementor session, Object object) throws HibernateException {

        if (!getEntityClass().isInstance(object)) {
            return null;
        }

        return generate(session, getEntityClass().cast(object));
    }

    private TK generate(SessionImplementor session, TE entity) throws HibernateException {

        TK key = entity.getKey();

        if (key == null) {
            key = newKey();
        }

        if (isEmpty(key)) {
            populateKey(key, session);
        }

        return key;
    }

    protected abstract Class<TE> getEntityClass();

    protected abstract TK newKey();

    protected abstract boolean isEmpty(TK key);

    protected abstract void populateKey(TK key, SessionImplementor session);
}
